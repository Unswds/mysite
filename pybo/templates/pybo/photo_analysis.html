{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'style.css' %}">

<div class="container bg-white mt-5" style="max-width:900px;">
  <div class="card shadow p-4 fade-in-up">
    <h2 class="text-center mb-3">ğŸ” ì‚¬ì§„ ë¶„ì„</h2>

    <!-- â‘  ë‚¨ì€ íšŸìˆ˜ í‘œì‹œ -->
    <p class="text-end small text-muted mb-3">
      ì˜¤ëŠ˜ ë‚¨ì€ ë¶„ì„ íšŸìˆ˜: <strong>{{ remaining }}</strong> / 20
    </p>

    <!-- â‘¡ ë©”ì‹œì§€ ì¶œë ¥ -->
    {% if messages %}
  {% for msg in messages %}
    {# ë¡œê·¸ì¸-ì„±ê³µ(success)ì€ ê·¸ëƒ¥ ì†Œë¹„ë§Œ í•˜ê³  í‘œì‹œí•˜ì§€ ì•ŠëŠ”ë‹¤ #}
    {% if "success" not in msg.tags %}
      <div class="alert alert-{{ msg.tags }} py-2">
        {{ msg }}
      </div>
    {% endif %}
  {% endfor %}
{% endif %}

    <!-- â‘¢ ì´ë¯¸ì§€ ì—…ë¡œë“œ í¼ -->
    <form id="generate-form"
          method="post"
          enctype="multipart/form-data"
          action="{% url 'pybo:generate' %}">
      {% csrf_token %}
      <div class="row">
        <div class="col-md-6 text-center">
          <label for="imageInput" class="form-label">ì´ë¯¸ì§€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”!</label>
          <input type="file"
                 class="form-control mb-3"
                 id="imageInput"
                 name="image"
                 accept="image/*"
                 required>
          <button type="submit"
                  class="btn btn-gradient w-100 mb-3">
            ì´ë¯¸ì§€ ìƒì„±í•˜ê¸°
          </button>
          <div id="loading" style="display:none; margin-top:20px;">
            <div class="spinner-border" role="status" style="width:3rem; height:3rem;">
              <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
            </div>
            <p>ì´ë¯¸ì§€ ìƒì„±ì¤‘...</p>
          </div>
        </div>
        <div class="col-md-6 text-center">
          <label for="instructions" class="form-label">ì¶”ê°€ ìš”ì²­ì‚¬í•­</label>
          <textarea id="instructions"
                    name="instructions"
                    rows="3"
                    class="form-control"
                    placeholder="ìˆ˜ì •í•˜ê³  ì‹¶ì€ ì ì„ ë§ì”€í•´ì£¼ì„¸ìš”!"></textarea>
        </div>
      </div>
    </form>

    <!-- â‘£ ìƒì„±ëœ ì´ë¯¸ì§€ ëª©ë¡ -->
    {% if images %}
      <hr class="my-4">
      <h3 class="mb-3">ìƒì„±ëœ ì´ë¯¸ì§€ì™€ ì›ë³¸ í”„ë¡¬í”„íŠ¸</h3>
      <div class="row">
        {% for prompt, url in images %}
          <div class="col-sm-6 mb-4 text-center">
            <p class="small text-muted mb-2">{{ prompt }}</p>
            <img src="{{ url }}" class="img-fluid rounded shadow-sm">
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>

<!-- â‘¤ JS: ë¡œë”© ì¸ë””ì¼€ì´í„° í† ê¸€ -->
<script>
  const genForm = document.getElementById('generate-form');
  const loading = document.getElementById('loading');

  genForm.addEventListener('submit', () => {
    loading.style.display = 'block';
  });
</script>
{% endblock %}
