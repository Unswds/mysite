{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'style.css' %}">

<div class="container bg-white mt-5" style="max-width:900px;">
  <div class="card shadow p-4 fade-in-up">

    <!-- ì œëª© -->
    <h2 class="text-center mb-3">ğŸ” ì‚¬ì§„ ë¶„ì„</h2>

    <!-- â‘  ë‚¨ì€ íšŸìˆ˜ í‘œì‹œ -->
    <p class="text-end small text-muted mb-3">
      ì˜¤ëŠ˜ ë‚¨ì€ ë¶„ì„ íšŸìˆ˜: <strong>{{ remaining|default:"0" }}</strong> / 20
    </p>

    <!-- â‘¡ ë©”ì‹œì§€ ì¶œë ¥ -->
    {% if messages %}
      {% for msg in messages %}
        {% if "success" not in msg.tags %}
          <div class="alert alert-{{ msg.tags }} py-2 px-3 mb-3">
            {{ msg }}
          </div>
        {% endif %}
      {% endfor %}
    {% endif %}

    <!-- â‘¢ ì´ë¯¸ì§€ ì—…ë¡œë“œ í¼ -->
    <form
      id="generate-form"
      method="post"
      enctype="multipart/form-data"
      action="{% url 'pybo:generate' %}"
    >
      {% csrf_token %}
      <div class="row gy-3">
        <!-- ì™¼ìª½ ì—…ë¡œë“œ ì˜ì—­ -->
        <div class="col-md-6 text-center">
          <label for="imageInput" class="form-label">ì´ë¯¸ì§€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”!</label>
          <input
            type="file"
            class="form-control mb-3"
            id="imageInput"
            name="image"
            accept="image/*"
            required
          >

          <button type="submit" class="btn btn-gradient w-100 mb-2">
            ì´ë¯¸ì§€ ìƒì„±í•˜ê¸°
          </button>

          <!-- ë¡œë”© ì¸ë””ì¼€ì´í„° -->
          <div id="loading" class="text-center" style="display:none;">
            <div class="spinner-border" role="status" style="width:3rem; height:3rem;">
              <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
            </div>
            <p class="mt-2 mb-0">ì´ë¯¸ì§€ ìƒì„±ì¤‘...</p>
          </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ì¶”ê°€ ìš”ì²­ì‚¬í•­ + âœ¨ì¥ë¥´ ì„ íƒ-->
    <div class="col-md-6">
      <label for="genre" class="form-label">ì†Œì„¤ ì¥ë¥´</label>
      <select id="genre" name="genre" class="form-select mb-3">
        <option value="">-- ì¥ë¥´ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
        <option value="ë¡œë§¨ìŠ¤">ë¡œë§¨ìŠ¤</option>
        <option value="íŒíƒ€ì§€">íŒíƒ€ì§€</option>
        <option value="SF">SF</option>
        <option value="ì¶”ë¦¬">ì¶”ë¦¬</option>
        <option value="ê³µí¬">ê³µí¬</option>
      </select>

      <label for="instructions" class="form-label">ì¶”ê°€ ìš”ì²­ì‚¬í•­</label>
      <textarea id="instructions" name="instructions"
                rows="5" class="form-control"
                placeholder="ìˆ˜ì •í•˜ê³  ì‹¶ì€ ì ì„ ë§ì”€í•´ì£¼ì„¸ìš”!">
        {{ instructions|default_if_none:"" }}
      </textarea>
    </div>
  </div>
</form>

    <!-- â‘£ ìƒì„±ëœ ì´ë¯¸ì§€ ëª©ë¡ -->
    {% if images %}
      <hr class="my-4">
      <h3 class="mb-3">ìƒì„±ëœ ì´ë¯¸ì§€ì™€ ì›ë³¸ í”„ë¡¬í”„íŠ¸</h3>

      <div class="row row-cols-1 row-cols-md-2 g-4">
        {% for prompt, url in images %}
          <div class="col text-center">
            <p class="small text-muted mb-2">{{ prompt }}</p>
            <img
              src="{{ url }}"
              alt="generated scene {{ forloop.counter }}"
              class="img-fluid rounded shadow-sm"
            >
          </div>
        {% endfor %}
      </div>
    {% endif %}

  </div> <!-- /.card -->
</div> <!-- /.container -->

<!-- â‘¤ JS: ë¡œë”© ì¸ë””ì¼€ì´í„° í† ê¸€ -->
<script>
  document.getElementById("generate-form").addEventListener("submit", () => {
    document.getElementById("loading").style.display = "block";
  });
</script>
{% endblock %}
